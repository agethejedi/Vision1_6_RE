<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>RiskXLabs — Vision 1_5_RE</title>

  <link rel="icon" href="./assets/favicon.png" type="image/png"/>
  <link rel="preload" href="./assets/css/theme.css" as="style"/>
  <link rel="stylesheet" href="./assets/css/theme.css"/>
  <link rel="stylesheet" href="./styles.css"/>

  <!-- Config first (sets window.VisionConfig.*) -->
  <script type="module" src="./config.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img class="favicon" src="./assets/favicon.png" alt=""/>
      <span class="brand-text">Risk<span class="brand-x">X</span>Labs Vision</span>
    </div>
    <nav class="nav">
      <button id="refreshBtn" class="btn">Refresh View</button>
      <select id="networkSelect" class="select">
        <option value="eth" selected>Ethereum</option>
        <option value="polygon">Polygon</option>
        <option value="arbitrum">Arbitrum</option>
      </select>
    </nav>
  </header>

  <main class="layout">
    <!-- LEFT: Graph + Controls -->
    <section class="left">
      <div class="panel">
        <h3 class="panel-title">Graph</h3>

        <div id="graph" class="graph-canvas" aria-label="Network graph">
          <!-- graph.js renders the SVG here -->
          <div class="graph-controls">
            <button id="navBack" class="btn" title="Back">⟵</button>
            <button id="navForward" class="btn" title="Forward">⟶</button>
            <button id="resetView" class="btn" title="Reset">Reset</button>
            <button id="zoomFit" class="btn" title="Zoom Fit">Fit</button>
          </div>
        </div>

        <div class="status-line">
          <div>
            <input id="seedInput" class="input" placeholder="Seed address (0x…)" />
            <button id="loadSeedBtn" class="btn">Load</button>
            <button id="clearBtn" class="btn btn-ghost">Clear</button>
          </div>
          <div id="neighborStatus" class="meta">Idle</div>
        </div>

        <!-- Under-graph Control Panel -->
        <div class="control-panel">
          <div class="group">
            <h4>Risk Engine</h4>
            <label><input id="flagEngine" type="checkbox" checked/> Use Risk Engine v1_5_RE</label>
            <label><input id="flagHeatmap" type="checkbox"/> Heatmap overlay</label>
            <label><input id="flagSizeByValue" type="checkbox"/> Node size by value</label>
          </div>
          <div class="group">
            <h4>Signals</h4>
            <label><input id="flagCustodian" type="checkbox" checked/> Custodian tagging</label>
            <label><input id="flagPlatform" type="checkbox" checked/> Platform flags (incl. Tokenlon)</label>
            <label><input id="flagMixer" type="checkbox" checked/> Mixer proximity</label>
          </div>
        </div>

        <div id="batchStatus" class="meta">Ready</div>
      </div>
    </section>

    <!-- RIGHT: Details + Narrative -->
    <section class="right">
      <div class="panel">
        <h3 class="panel-title">Details</h3>

        <!-- Score panel container used by ScoreMeter('#scorePanel') -->
        <div id="scorePanel" class="score-panel">
          <div class="meter">
            <svg viewBox="0 0 100 100" class="ring">
              <circle cx="50" cy="50" r="45" class="track" fill="none" stroke-width="8"></circle>
              <circle cx="50" cy="50" r="45" class="arc"   fill="none" stroke-width="8" stroke-linecap="round" stroke-dasharray="0 999"></circle>
            </svg>
            <div class="label">
              <div class="score-text">0</div>
              <div class="score-sub">Moderate</div>
            </div>
          </div>
          <div class="reasons"></div>
        </div>

        <div id="entityMeta" class="meta"></div>
      </div>

      <!-- Narrative Summary -->
      <div id="narrativePanel" class="panel narrative" hidden>
        <h3 class="panel-title">Narrative Summary</h3>

        <div id="rxlBadges" class="badges"></div>
        <div id="rxlNarrativeText" class="card"></div>

        <div class="status-line">
          <div class="meta">Mode:
            <select id="rxlMode" class="select" style="min-width: 130px;">
              <option value="analyst" selected>Analyst</option>
              <option value="consumer">Consumer</option>
            </select>
          </div>
          <div>
            <button id="rxlCopy" class="btn">Copy</button>
            <button id="rxlExport" class="btn">Export</button>
          </div>
        </div>

        <table id="rxlFactors">
          <thead>
            <tr><th>Factor</th><th>Metrics</th><th style="text-align:right;">Δ</th><th>Source</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="foot">
    <span>© RiskXLabs — We Fight Fraud</span>
  </footer>

  <!-- Entry (imports graph + ScoreMeter and wires the worker) -->
  <script type="module" src="./app.js"></script>
</body>
</html>
